<!doctype html>
<html lang="en" class="full-height">

<head>
    <title>--==[ HC ]==--</title>
    <link rel="icon" type="image/png" href="material-kit/assets/img/favicon.png">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <!-- Fonts and icons -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- Material Kit CSS -->
    <link href="material-kit/assets/css/material-kit.css?v=2.2.0" rel="stylesheet" />
    <style>
        .full-height {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .fill-height {
            flex-grow: 1;
            width: 100%;
        }

        .alert-doctor {
            color: #114e7e;
            background-color: #e8f8ff;
        }
    </style>

    <!-- Mock data -->
    <script>
        hcData = {
            "Demographics": {
                "lastName": "Bourne",
                "firstName": "Jason",
                "dob": "April 20, 1970 (49)",
                "gender": "Male",
                "identifiesAs": "They",
                "weight": "84.3 kgs (186 lbs)",
                "height": "178 cm (5' 10\")",
                "photo": "material-kit/assets/img/OntDriversLicense.jpg",
                "conditions": [
                    " Osteoarthritis",
                    " Insomnia",
                    " Hypertension",
                ],
                "contraindications": [
                    "Percocet 2012-2014",
                ],
            },
            "Clinical": {
                "prescribingHCP": "Dr. Mary Smith",
                "clinic": "Wise Elephant FHT",
                "prescriptions": {
                    "strain": ["Sativa", "Hybrid"],
                    "format": ["dried", "oil", "edible"],
                    "cbdPercent": "5",
                    "thcPercent": "25",
                    "gramsPerDay": "1",
                    "duration": "30",
                },
            },
            "orderHx": [
                { "product": "10:10 Balance oil", "orderDate": "August 27, 2018", "instructions": "Take 3 drops 1 hr before bed.", "cost": "$172.00" },
                { "product": "10:10 Balance oil", "orderDate": "September 26, 2018", "instructions": "Take 5 drops 1 hr before bed. Mix into tea.", "cost": "$172.00" },
                { "product": "10:10 Balance oil", "orderDate": "October 25, 2018", "instructions": "Take 6 drops 1 hr before bed. Mix into tea.", "cost": "$258.00" },
                { "product": "10:10 Balance oil", "orderDate": "December 28, 2018", "instructions": "Take 6 drops 1 hr before bed. Mix into tea.", "cost": "$516.00" },
                { "product": "5:20 CBD oil", "orderDate": "April 14, 2019", "instructions": "Take 6 drops 1 hr before bed. Mix into tea.", "cost": "$86.00" },
                { "product": "1:25 CBD oil", "orderDate": "May 24, 2019", "instructions": "Take 6 drops 1 hr before bed. Mix into tea.", "cost": "$92.00" },
                { "product": "1:25 CBD oil", "orderDate": "June 26, 2019", "instructions": "Take 6 drops 1 hr before bed. Mix into tea.", "cost": "$276.00" },
                { "product": "1:25 CBD oil", "orderDate": "September 29, 2019", "instructions": "Take 6 drops 1 hr before bed. Mix into tea.", "cost": "$276.00" }
            ]
        }

        //Special case where a is in local time and b is in UTC
        function dateDiffInDays(a, b) {
            // Discard the time and time-zone information.
            b = new Date(b.getTime() + tday.getTimezoneOffset() * 60000); //Since b's TZ is not specified it will be treated as UTC, we have to add the offset to get it to local time so that when it's converted to UTC it does not slide back a day.
            const utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
            const utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
            return Math.floor((utc2 - utc1) / 86400000);    //milliseconds in a day (1000*60*60*24)
        }

        hcConfig = {
            "inventoryMinDays": 3,
            "inventorySafeDays": 7,
            "maxCBD": 40,
            "maxTHC": 50,
            "conditions": ["Insomnia", "Anxiety", "Depression", "Pain", "PTSD", "Nausea", "Anorexia", "Cancer", "HIV/AIDS", "Alzheimer`s", "Crohn`s", "Epilepsy"],
        }
        hcConfig.conditions.sort();

        const tday = new Date();
        const minDaysGreenInventory = hcConfig.inventorySafeDays;    // 3-7 days and inventory will appear yellow (warning colour)
        const minDaysYellowInventory = hcConfig.inventoryMinDays;   // <3 days and inventory will appear red (critical colour)
        const maxCBD = hcConfig.maxCBD;
        const maxTHC = hcConfig.maxTHC;

        var tabledata = [
            { id: 1, name: "Bob Marley Special", lp: "Aurora", strain: "Indica", cbd: "5", thc: "30", format: "dried", rating: "4.5", inventoryExpiry: "2020-01-17", unitPrice: "12.95", units: "g", terepen: "Myrcene" },
            { id: 2, name: "Purple Kush", lp: "Aurora", strain: "Sativa", cbd: "10", thc: 20, format: "dried", rating: "4.2", inventoryExpiry: "2020-01-28", unitPrice: "11.20", units: "g", terepen: "Caryophyllene" },
            { id: 3, name: "CBD Drops", lp: "Aurora", strain: "Hyrbrid", cbd: 0.8, thc: "22-30", format: "oil", rating: "4.1", inventoryExpiry: "2020-01-29", unitPrice: "11.20", units: "g", terepen: "Pinene" },
            { id: 4, name: "Raspberry THC Gummies", lp: "Aurora", strain: "Indica", cbd: 0, thc: 2, format: "edible", rating: "2", inventoryExpiry: "2020-01-26", unitPrice: "11.20", units: "g", terepen: "limonene" },
            { id: 5, name: "Aurora THC Drops", lp: "Aurora", strain: "Sativa", cbd: 0, thc: 27, format: "oil", rating: "4.2", inventoryExpiry: "2020-02-25", unitPrice: "11.20", units: "g", terepen: "Pinene" },
            { id: 6, name: "Ambition", lp: "Aurora", strain: "Hybrid", cbd: 1, thc: 1, format: "dried", rating: "4.2", inventoryExpiry: "2020-02-22", unitPrice: "11.20", units: "g", terepen: "Myrcene" },
            { id: 7, name: "Marley Natural", lp: "Aurora", strain: "Indica", cbd: 40, thc: 40, format: "dried", rating: "4.2", inventoryExpiry: "2020-01-21", unitPrice: "11.20", units: "g", terepen: "Pinene" },
            { id: 8, name: "Apothecanna", lp: "Aurora", strain: "Indica", cbd: 2, thc: 2, format: "dried", rating: "4.2", inventoryExpiry: "2020-01-22", unitPrice: "11.20", units: "g", terepen: "limonene" },
            { name: "Caviar Gold", lp: "MM", strain: "Sativa", cbd: 3, thc: 3, format: "dried", rating: "4.2", inventoryExpiry: "2020-01-23", unitPrice: "11.20", units: "g", terepen: "limonene" },
            { name: "Willie's Reserve", lp: "MM", strain: "Sativa", cbd: 4, thc: 4, format: "dried", rating: "4.2", inventoryExpiry: "2020-01-24", unitPrice: "11.20", units: "g", terepen: "Terpinolene" },
            { name: "Afghan", lp: "MM", strain: "Hybrid", cbd: 5, thc: 5, format: "dried", rating: "4.2", inventoryExpiry: "2020-02-23", unitPrice: "11.20", units: "g", terepen: "Humulene" },
            { name: "Funky Monkey", lp: "MM", strain: "Hybrid", cbd: 40, thc: 25, format: "dried", rating: "4.2", inventoryExpiry: "2020-02-24", unitPrice: "11.20", units: "g", terepen: "Linalool" },
            { name: "Blackwater", lp: "MM", strain: "Hybrid", cbd: 3, thc: 3, format: "oil", rating: "4.2", inventoryExpiry: "2020-01-23", unitPrice: "11.20", units: "g", terepen: "Ocimene" },
            { name: "Blueberry", lp: "MM", strain: "Hybrid", cbd: 4, thc: 4, format: "capsule", rating: "4.6", inventoryExpiry: "2020-01-25", unitPrice: "11.20", units: "g", terepen: "Nerolidol" },
            { name: "Dynamite", lp: "MM", strain: "Sativa", cbd: 5, thc: 5, format: "edible", rating: "4.5", inventoryExpiry: "2020-02-26", unitPrice: "11.20", units: "g", terepen: "Linalool" },
            { name: "Edelweiss", lp: "MM", strain: "Sativa", cbd: 15, thc: 50, format: "oil", rating: "4.0", inventoryExpiry: "2020-02-27", unitPrice: "11.20", units: "g", terepen: "Humulene" },
            { name: "Kryptonite", lp: "MM", strain: "Indica", cbd: 3, thc: 30, format: "capsule", rating: "4.1", inventoryExpiry: "2020-01-28", unitPrice: "11.20", units: "g", terepen: "Bisabolol" },
            { name: "Lions Gate", lp: "MM", strain: "Indica", cbd: 40, thc: 4, format: "oil", rating: "4.2", inventoryExpiry: "2020-01-29", unitPrice: "11.20", units: "g", terepen: "Nerolidol" },
            { name: "Mango", lp: "MM", strain: "Indica", cbd: 5, thc: 15, format: "topical", rating: "4.3", inventoryExpiry: "2020-02-28", unitPrice: "11.20", units: "g", terepen: "Pinene" },
            { id: 9, name: "Midnight", lp: "MedReleaf", strain: "Sativa", cbd: "8-12", thc: "6-10", format: "dried", rating: "4.1", inventoryExpiry: "2020-02-27", unitPrice: "11.91", units: "g", terepen: "Caryophyllene" },
        ];
        //Product table hygiene: transform/normalize data into presentation format
        for (var i = 0; i < tabledata.length; i++) {
            d = dateDiffInDays(tday, new Date(tabledata[i]["inventoryExpiry"]));
            t = d >= minDaysGreenInventory ? 2 : (d >= minDaysYellowInventory ? 1 : 0);
            tabledata[i]["inventoryLevel"] = t;
            tabledata[i]["inStock"] = "imgs/inventory" + t + ".png";
            tabledata[i]["displayCost"] = tabledata[i]["unitPrice"] + "/" + tabledata[i]["units"];
            //if CBD || THC is a range (e.g. 20-30) then trim the second number
            s = tabledata[i]["cbd"];
            if (typeof s == "string") { s = s.replace(/\-[\s\S]*/, ""); }
            tabledata[i]["cbdProgress"] = s;
            s = tabledata[i]["thc"];
            if (typeof s == "string") { s = s.replace(/\-[\s\S]*/, ""); }
            tabledata[i]["thcProgress"] = s;
            tabledata[i]["lpDisplay"] = "<img src='imgs/logo" + tabledata[i]["lp"] + ".png'> " + tabledata[i]["lp"];
        }

        var hcProductDetails = {
            "id": 9,
            "imgs": ["medreleaf-midnight.jpg", "medreleaf-midnight2.jpg", "medreleaf-midnight3.jpg", "medreleaf-midnight4.jpg", "medreleaf-midnight5.png"],
            "orderUnits": "bottle (30gm)",
            "orderQty": 1,
        }

        //Fake reviews for all Products * all conditions
        for (var i=0; i<tabledata.length; i++) {
            for (var j=0; j<hcConfig.conditions.length; j++) {
                s = hcConfig.conditions[j];
                tabledata[i][s] = Math.floor(Math.random() * 100); 
            }
        }

    </script>
</head>

<body onload="onLoadReady()" class="full-height">

    <!-- demographics -->
    <div class="card" style="margin-top: 0px; margin-bottom: 0px; background-color: #eee;">
        <div class="card-body ">
            <div class="row">
                <div class="">
                    <button class="" data-toggle="modal" data-target="#smallAlertModal"
                        style="border-width: 0px; background-color: #eee;">
                        <div class="author" style="background-color: #eee;">
                            <img id="hc_photoSml" src="" class="avatar img-raised" style="width: 55px; height: 55px;">
                        </div>
                    </button>
                    <!-- modal large photo -->
                    <div class="modal fade" id="smallAlertModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-small" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i
                                            class="material-icons">clear</i></button>
                                </div>
                                <div class="modal-body text-center">
                                    <img id="hc_photoLrg" src="" class="avatar img-raised"
                                        style="width: 250px; height: 250px;"></br>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end modal -->
                </div>
                <div class="col-10">
                    <div class="row">
                        <div class="col-12">
                            <div class="row">
                                <div class="col"><span id="hc_name"></span></div>
                                <div class="col-lg"><b>DOB:</b> <span id="hc_dob"></span></div>
                                <div class="col"><b>Gender (at birth):</b> <span id="hc_gender"></span></div>
                                <div class="col"><span id="hc_identifiesAsContainer"><b>Identifies as:</b> <span
                                            id="hc_identifiesAs"></span></span></div>
                                <div class="col-xl"><b>Weight:</b> <span id="hc_weight"></span></div>
                                <div class="col"><b>Height:</b> <span id="hc_height"></span></div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="row">
                                <div class="col"><span>
                                        <i class="material-icons" style="  margin: 0;position: relative;top: 8px;">
                                            healing</i>
                                        <b>Conditions:</b> <span id="hc_conditions"></span>
                                    </span></div>
                                <div class="col-lg"><span>
                                        <i class="material-icons" style="  margin: 0;position: relative;top: 8px;">
                                            warning</i>
                                        <b>Possible Contraindications:</b> <span id="hc_contraindications"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- filters -->
    <div class="card" style="margin-top: 0px; margin-bottom: 0px;">
        <div class="card-body " style="background-color: #ffffff;">
            <div class="row">
                <div class="col-sm-auto">
                    <b>Rx:</b> <span id="hc_prescribingHCP" class="alert-doctor"></span> </br>
                    &nbsp; <span id="hc_clinic" class="alert-doctor"></span>
                </div>
                <div class="col-lg-auto">
                    <div class="row">
                        <div class="col">
                            <b>Strain:</b> <span id="hc_strain" class="alert-doctor"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_strainIndica" value="Indica"
                                        onchange="filterPL()">Indica&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_strainSativa" value="Sativa"
                                        onchange="filterPL()">Sativa&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_strainHybrid" value="Hybrid"
                                        onchange="filterPL()">Hybrid&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-auto">
                    <div class="row">
                        <div class="col">
                            <b>CBD% &gt; </b> <span class="alert-doctor">(<span id="hc_cbdPercent"></span>%)</span>
                            <input id="hc_sliderCBDVal" style="width:35px; height:25px;">%
                        </div>
                    </div>
                    <div class="row">
                        <div class="col" style="min-width: 200px;">
                            <div id="hc_sliderCBDControl" class="slider"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-auto">
                    <div class="row">
                        <div class="col">
                            <b>THC% &lt; </b> <span class="alert-doctor">(<span id="hc_thcPercent"></span>%)</span>
                            <input id="hc_sliderTHCVal" style="width:35px; height:25px;">%
                        </div>
                    </div>
                    <div class="row">
                        <div class="col" style="min-width: 200px;">
                            <div id="hc_sliderTHCControl" class="slider"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-auto">
                    <div class="row">
                        <div class="col">
                            <b>Format:</b> <span id="hc_format" class="alert-doctor"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_formatDried"
                                        onchange="filterPL()" value="Dried">Dried&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_formatCapsule"
                                        onchange="filterPL()" value="Capsule">Capsule&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_formatOil"
                                        onchange="filterPL()" value="Oil">Oil&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_formatTopical"
                                        onchange="filterPL()" value="Topical">Topical&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_formatEdible"
                                        onchange="filterPL()" value="Edible">Edible&nbsp;&nbsp;
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-auto">
                    <b>Quantity (daily):</b> <span id="hc_gramsPerDay" class="alert-doctor"></span> </br>
                    <b>Duration (days):</b> <span id="hc_duration" class="alert-doctor"></span>
                </div>
            </div>
        </div>
    </div>
    <!-- filters: advanced search -->
    <div id="accordion" role="tablist" aria-multiselectable="true" class="card-collapse">
        <div class="card card-plain" style="margin-top: 0px; margin-bottom: 0px;">
            <div class="card-header" role="tab" id="headingOne" style="padding-top: 0px; margin-top: -20px;">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true"
                    aria-controls="collapseOne" style="float: right; margin-top: 0px; font-size: smaller;">
                    Advanced search
                    <i class="material-icons" style="top:0px">keyboard_arrow_down</i>
                </a>
            </div>
            <div id="collapseOne" class="collapse show" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-body" style="background-color: #fff;">
                    <div class="row" style="margin-left: 15px;">
                        <div class="col-sm-auto">
                            <div class="btn-group">
                                <button class="btn btn-info btn-sm dropdown-toggle" style="margin-top: -12px;"
                                    type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span id="hcCondition1Label">Condition 1</span>
                                </button>
                                <div class="dropdown-menu" id="hcConditions1">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-auto">
                            <div class="btn-group">
                                <button class="btn btn-info btn-sm dropdown-toggle" style="margin-top: -12px;"
                                    type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span id="hcCondition2Label">Condition 2</span>
                                </button>
                                <div class="dropdown-menu" id="hcConditions2">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-auto">
                            <div class="form-check form-check-inline" style="margin: 0px;">
                                <label class="form-check-label" style="color: #000000; padding-left: 20px;">
                                    <input class="form-check-input" type="checkbox" id="hc_inStockOnly"
                                        onchange="filterPL()" checked value="inStock">in-stock only
                                    <span class="form-check-sign">
                                        <span class="check"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-auto">
                            <button class="btn btn-default btn-round btn-sm"
                                style="padding-top: 3px; padding-bottom: 3px; margin-top: 0px;"
                                onclick="filterPLClear()">Show all</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- product list & details -->
    <div id="hc_productListContainer" class="container-fluid fill-height"
        style="margin-top: 5px; margin-bottom: 0px; margin-left: -10px;">
        <div class="row">
            <div class="col-lg-8" style="padding-right: 0px;">
                <div id="hc_productList"></div>
            </div>
            <div class="col-lg-4" style="padding-left: 10px; padding-right: 0px;">
                <div id="hc_productDetails">
                    <ul class="nav nav-tabs" id="myTab" role="tablist" style="background-color: #80a0ff; padding:0px;">
                        <li class="nav-item">
                            <a class="nav-link active" id="details-tab" data-toggle="tab" href="#details" role="tab"
                                aria-controls="details" aria-selected="true">Details</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="rxhx-tab" data-toggle="tab" href="#rxhx" role="tab"
                                aria-controls="rxhx" aria-selected="false">Rx Hx</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="rxhx-tab" data-toggle="tab" href="#prescribe" role="tab"
                                aria-controls="prescribe" aria-selected="false">Prescription</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="details" role="tabpanel"
                            aria-labelledby="details-tab"><i>Select a product</i></div>
                        <div class="tab-pane fade" id="rxhx" role="tabpanel" aria-labelledby="rxhx-tab">
                            </br>
                            <div class=col-md-12>
                                <div class=card>
                                    <div class=card-header style="padding: 5px 10px 5px 10px;">
                                        <h4 class=card-title
                                            style="margin-top: 0px; font-family: Arial, Helvetica, sans-serif;">Order
                                            History</h4>
                                    </div>
                                    <div class=card-body>
                                        <div class=table-responsive id="hcOrderHx"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="prescribe" role="tabpanel" aria-labelledby="prescribe-tab">
                            <i>Select a product and <b>add</b> it</i></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Populate fields -->
    <script>
        var tablePL;    //Define at a global scope - so that the table can be referenced anywhere

        function hc_populate(fld, val) {
            document.getElementById(fld).innerHTML = val;
        }
        hc_populate("hc_name", hcData.Demographics.lastName + ", " + hcData.Demographics.firstName);
        hc_populate("hc_dob", hcData.Demographics.dob);
        hc_populate("hc_gender", hcData.Demographics.gender);
        hc_populate("hc_identifiesAs", hcData.Demographics.identifiesAs);
        hc_populate("hc_height", hcData.Demographics.height);
        hc_populate("hc_weight", hcData.Demographics.weight);
        hc_populate("hc_conditions", hcData.Demographics.conditions);
        hc_populate("hc_contraindications", hcData.Demographics.contraindications);
        document.getElementById("hc_photoSml").src = hcData.Demographics.photo;
        document.getElementById("hc_photoLrg").src = hcData.Demographics.photo;
        hc_populate("hc_prescribingHCP", hcData.Clinical.prescribingHCP);
        hc_populate("hc_clinic", hcData.Clinical.clinic);
        hc_populate("hc_strain", (hcData.Clinical.prescriptions.strain).toString().replace(/,/gi, ", "));
        hc_populate("hc_cbdPercent", hcData.Clinical.prescriptions.cbdPercent);
        hc_populate("hc_thcPercent", hcData.Clinical.prescriptions.thcPercent);
        hc_populate("hc_format", hcData.Clinical.prescriptions.format.toString().replace(/,/gi, ", "));
        hc_populate("hc_gramsPerDay", hcData.Clinical.prescriptions.gramsPerDay);
        hc_populate("hc_duration", hcData.Clinical.prescriptions.duration);
        if (hcData.Demographics.gender == hcData.Demographics.identifiesAs) {
            document.getElementById("hc_identifiesAsContainer").style = "width: 0px; height: 0px; display:inline-block; overflow: hidden";
        }
        (hcData.Clinical.prescriptions.strain).forEach(function (item) {
            if (item == "Indica") { document.getElementById("hc_strainIndica").checked = true; }
            if (item == "Sativa") { document.getElementById("hc_strainSativa").checked = true; }
            if (item == "Hybrid") { document.getElementById("hc_strainHybrid").checked = true; }
        });
        (hcData.Clinical.prescriptions.format).forEach(function (item) {
            if (item == "dried") { document.getElementById("hc_formatDried").checked = true; }
            if (item == "capsule") { document.getElementById("hc_formatCapsule").checked = true; }
            if (item == "oil") { document.getElementById("hc_formatOil").checked = true; }
            if (item == "edible") { document.getElementById("hc_formatEdible").checked = true; }
            if (item == "topical") { document.getElementById("hc_formatTopical").checked = true; }
        });

        //Some features are not available until all the libraries have loaded
        function onLoadReady() {

            //CBD Slider
            var hc_sliderCBD = document.getElementById('hc_sliderCBDControl');
            noUiSlider.create(hc_sliderCBD, {
                start: 0,
                connect: [false, true],
                step: 5,
                range: {
                    min: 0,
                    max: 100
                }
            });
            hc_sliderCBD.noUiSlider.set(hcData.Clinical.prescriptions.cbdPercent);
            var hc_sliderCBDVal = document.getElementById('hc_sliderCBDVal');
            hc_sliderCBD.noUiSlider.on('update', function (values, handle) {
                hc_sliderCBDVal.value = values[handle] * 1;
                filterPL();
            });
            hc_sliderCBDVal.addEventListener('change', function () {
                hc_sliderCBD.noUiSlider.set(this.value);
                filterPL();
            });

            //THC Slider
            var hc_sliderTHC = document.getElementById('hc_sliderTHCControl');
            noUiSlider.create(hc_sliderTHC, {
                start: 0,
                connect: [true, false],
                step: 5,
                range: {
                    min: 0,
                    max: 100
                }
            });
            hc_sliderTHC.noUiSlider.set(hcData.Clinical.prescriptions.thcPercent);
            var hc_sliderTHCVal = document.getElementById('hc_sliderTHCVal');
            hc_sliderTHC.noUiSlider.on('update', function (values, handle) {
                hc_sliderTHCVal.value = values[handle] * 1;
                filterPL();
            });
            hc_sliderTHCVal.addEventListener('change', function () {
                hc_sliderTHC.noUiSlider.set(this.value);
                filterPL();
            });

            //Condition/symptom dropdown boxes
            var s = "";
            hcConfig.conditions.forEach(el => { s += '<a class="dropdown-item" onclick="hcConditionSelect(\''+el+'\',1)">' + el + '</a>'; });
            document.getElementById("hcConditions1").innerHTML = s;
            s = "";
            hcConfig.conditions.forEach(el => { s += '<a class="dropdown-item" onclick="hcConditionSelect(\''+el+'\',2)">' + el + '</a>'; });
            document.getElementById("hcConditions2").innerHTML = s;

            //Order history
            var s = '<table class="table"><thead class="text-primary">';
            s += '<th>Product</th><th>Date</th><th class="text-right">Amount</th></thead><tbody>';
            for (var i = hcData.orderHx.length - 1; i >= 0; i--) {
                s += '<tr>';
                s += '<td>' + hcData.orderHx[i].product + '</td>';
                s += '<td>' + hcData.orderHx[i].orderDate + '</td>';
                // s += '<td>' + hcData.orderHx[i].instructions + '</td>';
                s += '<td class="text-right">' + hcData.orderHx[i].cost + '</td>';
                s += '</tr>';
            }
            s += '</tbody></table>';
            document.getElementById("hcOrderHx").innerHTML = s;

            //Product table
            tablePL = new Tabulator("#hc_productList", {
                height: document.getElementById("hc_productListContainer").clientHeight, // Set height same as container. set height of table (in CSS or here), this enables the Virtual DOM and improves render speed dramatically (can be any valid css height value)
                layout: "fitColumns", //fit columns to width of table (optional)
                data: tabledata,
                // autoColumns: true,
                columns: [ //Define Table Columns
                    { title: "Name", field: "name", width: 150 },
                    { title: "LP", field: "lpDisplay", align: "left", formatter: "html" },
                    { title: "Strain", field: "strain", align: "left", width: 80 },
                    { title: "CBD", field: "cbdProgress", formatter: "progress", formatterParams: { legend: true, max: maxCBD, color: "#00a060" } },
                    { title: "THC", field: "thcProgress", formatter: "progress", formatterParams: { legend: true, max: maxTHC } },
                    { title: "Format", field: "format", width: 80 },
                    { title: "Primary Terepen", field: "terepen" },
                    { title: "Rating", field: "rating", formatter: "star", width: 90 },
                    { title: "In-stock", field: "inStock", width: 90, formatter: "image", formatterParams: { height: 25, width: 15 }, align: "center" },
                    { title: "Price", field: "displayCost", sorter: "date", align: "center" },
                ],
                initialSort: [
                    //documentation is backwards. In reality the primary sort is last in this list. (First in list is the inner-most sort)
                    { column: "inStock", dir: "desc" },
                    { column: "lpDisplay", dir: "asc" },
                ],
                rowClick: function (e, row) {
                    rowSelectedPL(row.getData().id);
                },
            });

            //Apply initial filters to the Product List table
            setTimeout(() => { filterPL(); }, 200);

            //Display tab Order History
            $('.nav-tabs a[href="#rxhx"]').tab('show');

            //Collapse the accordian (Advanced Filters)
            $('#collapseOne').collapse("hide");
        };
    </script>

    <!-- Site functions -->
    <script>
        //Apply filters to ProductList
        function filterPL() {
            var s = [];
            var f = [];
            if (document.getElementById("hc_strainIndica").checked) { s.push("Indica"); }
            if (document.getElementById("hc_strainSativa").checked) { s.push("Sativa"); }
            if (document.getElementById("hc_strainHybrid").checked) { s.push("Hybrid"); }
            if (document.getElementById("hc_formatDried").checked) { f.push("dried"); }
            if (document.getElementById("hc_formatCapsule").checked) { f.push("capsule"); }
            if (document.getElementById("hc_formatOil").checked) { f.push("oil"); }
            if (document.getElementById("hc_formatTopical").checked) { f.push("topical"); }
            if (document.getElementById("hc_formatEdible").checked) { f.push("edible"); }
            if (typeof tablePL != "undefined") {    //Don't filter the table if it hasn't been constructed yet
                tablePL.setFilter([
                    { field: "strain", type: "in", value: s },
                    { field: "format", type: "in", value: f },
                    { field: "thcProgress", type: "<=", value: (document.getElementById('hc_sliderTHCVal').value * 1) },
                    { field: "cbdProgress", type: ">=", value: (document.getElementById('hc_sliderCBDVal').value * 1) },
                    { field: "inventoryLevel", type: ">=", value: (document.getElementById("hc_inStockOnly").checked * 1) },
                ])
            }
        }

        //Clear all filters from ProductList
        function filterPLClear() {
            document.getElementById("hc_strainIndica").checked = true;
            document.getElementById("hc_strainSativa").checked = true;
            document.getElementById("hc_strainHybrid").checked = true;
            document.getElementById("hc_formatDried").checked = true;
            document.getElementById("hc_formatCapsule").checked = true;
            document.getElementById("hc_formatOil").checked = true;
            document.getElementById("hc_formatTopical").checked = true;
            document.getElementById("hc_formatEdible").checked = true;
            document.getElementById("hc_inStockOnly").checked = false;
            document.getElementById('hc_sliderTHCVal').value = "100";
            document.getElementById('hc_sliderCBDVal').value = "0";
            document.getElementById('hc_sliderTHCControl').noUiSlider.set([100]);
            document.getElementById('hc_sliderCBDControl').noUiSlider.set([0]);
            filterPL();
        }

        //A condition has been selected from Advanced Search. Add the condition column to the table and sort by it
        var hcCond = ["", ""];
        function hcConditionSelect(condition, list) {
            document.getElementById("hcCondition"+ list +"Label").innerHTML = condition;
            list--;
            if (hcCond[list]!="") {
                //column already exists, therefore update it (delete and recreate)
                tablePL.deleteColumn( hcCond[list] );
            }
            tablePL.addColumn({ title: condition, field: condition, formatter: "progress", formatterParams: { legend: true, max: 100, color: "#00bcd4" } }, false);
            hcCond[list] = condition;
        }

        //When a row is clicked in the Product List table --> Set the tab to 'Details' and update the details content
        function rowSelectedPL(rowID) {
            var t = "";
            for (var i = 0; i < tabledata.length; i++) { if (tabledata[i].id == rowID) { t = tabledata[i]; break; } }
            var s = '';
            //Add to prescription
            s += '<div id="hcSelectQty" style="margin-top:10px; margin-bottom:10px; padding:5px; background-color:#dcdcdc; text-align:center;">Add to prescription: ';
            s += '<input type="text" id="hcAddQty" value="' + hcProductDetails.orderQty + '" style="width:40px; text-align:right; padding: 0px 5px;"> ' + hcProductDetails.orderUnits + ' ';
            s += '<button class="btn btn-default btn-round btn-sm" onclick="addToOrder()">Add</button></div>';
            //Image carousel
            s += '<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">';
            for (var i = 0; i < hcProductDetails.imgs.length; i++) {
                s += '<li data-target="#carouselExampleIndicators" data-slide-to="' + i + '"' + (i == 0 ? ' class="active"' : '') + '></li>';
            }
            s += '</ol><div class="carousel-inner">';
            for (var i = 0; i < hcProductDetails.imgs.length; i++) {
                s += '<div class="carousel-item' + (i == 0 ? ' active' : '') + '">';
                s += '<img class="d-block w-100" src="imgs/' + hcProductDetails.imgs[i] + '" alt="Slide #' + i + '"></div>';
            }
            s += '</div><a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a>';
            s += '<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a></div>';

            //INTERIM DISPLAY...
            s += "<b>Row ID: </b>" + rowID + "</br>";
            for (var key in t) { s += "<b>" + key + ": </b>" + t[key] + "</br>"; }
            //...interim display
            document.getElementById('details').innerHTML = s;
            $('.nav-tabs a[href="#details"]').tab('show');  //Set the Details tab as active
            $('.carousel').carousel({ interval: 5000 });    //Initiate the carousel
        }

        //When a product has been selected, and then the order quantity has been 'Add'ed, set the Prescription tab as active and add the product + qty to the prescription
        var hcOrderCart = [];
        function addToOrder(qty) {
            if (typeof qty == "undefined") { qty = document.getElementById("hcAddQty").value; }
            var prodID = hcProductDetails.id;
            // hcOrderCart[0] = prodID;
            // hcOrderCart[1] = hcProductDetails.name;
            // hcOrderCart[2] = qty;
            // hcOrderCart[3] = hcProductDetails.unitPrice;
            // var s = "<Table><thead><td>Product</td></thead>";
            //     for (var i=0; i<hcOrderCart.length; i++) {
            //         s += "<row><td>"+ hcOrderCart[1] + "</td></row>";
            //     }
            // s += "</table>";
            s += "Add [" + qty + "] of ID:" + prodID;
            document.getElementById('prescribe').innerHTML = s;
            $('.nav-tabs a[href="#prescribe"]').tab('show');  //Set the Prescription tab as active
        }
    </script>

    <!--   Core JS Files   -->
    <script src="material-kit/assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="material-kit/assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="material-kit/assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="material-kit/assets/js/plugins/moment.min.js"></script>
    <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
    <script src="material-kit/assets/js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="material-kit/assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
    <!--  Google Maps Plugin  -->
    <!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script> -->
    <!--	Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
    <script src="material-kit/assets/js/plugins/bootstrap-tagsinput.js"></script>
    <!--	Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
    <script src="material-kit/assets/js/plugins/bootstrap-selectpicker.js" type="text/javascript"></script>
    <!--	Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
    <script src="material-kit/assets/js/plugins/jasny-bootstrap.min.js" type="text/javascript"></script>
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
    <script src="material-kit/assets/js/material-kit.js?v=2.2.0" type="text/javascript"></script>
    <!-- Tabulator -->
    <!-- Run locally -->
    <link href="tabulator-master/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="tabulator-master/dist/js/tabulator.min.js"></script>
    <!-- Run via CDN -->
    <!-- <link href="https://unpkg.com/tabulator-tables@4.5.2/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.5.2/dist/js/tabulator.min.js"></script> -->
</body>

</html>